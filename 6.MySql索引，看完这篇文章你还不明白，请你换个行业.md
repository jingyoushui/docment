### MySql索引，看完这篇文章你还不明白，请你换个行业

正确的创建合适的索引是数据库优化的基础

#### 1.索引的本质：

索引是为了加速到表中数据行的检索而创建的一种分散存储的数据结构

在RDBMS系统中的数据的索引都是硬盘级的。

索引数据结构的特点将决定索引的性能

二叉搜索树会有可能成为单链表——>平衡二叉树Data Structure Visualizations，左旋右旋，搜索过程——>诟病：树的高度，1.高度等于IO次数，2.IO的效率太低，IO交互数据基本单位是页，一页4k，

——>多路平衡搜索树（B-）关键字个数=子叉路-1，

#### 2.Mysql为什么选择B+

——>mysql变形B+树，根节点和支节点不存储数据区，因为大部分的数据都在叶子节点，根节点也叶子节点的数据区是很多数据的数据区，以便能提高IO利用率。排序能力，双向链表连接在一起。基于索引数据结构扫表能力强。查询更加稳定，B-树命中即返回，但是B+树一定会到叶子节点。

——>Oracle变形B*树

#### 3.Mysql落地B+ Tree索引方案

mysql的插拔式的搜索引擎

查看mysql存放目录：show variables like 'datadir'

Myisam引擎：生成两个文件myi(index索引)文件和myd（data）文件

![](/home/lixing/文档/image/选区_237.png)

在myisam中有index_merge type           (执行计划？)

在innodb中没有索引文件，只有data文件，它会在叶子节点数据区保存真实的数据。基于组件的方式把数据和索引组织在一起，也叫做聚集索引

聚集索引：聚集索引是指数据库表行中数据的物理顺序与键值的逻辑（索引）顺序相同

在innodb中只有主键才是聚集索引，其他索引都是非聚集索引，辅助索引叶子节点的数据区保存的是主键的值。先根据辅助索引找到主键值，然后再去主键索引中根据主键值查找，这个过程叫做回表。

![](/home/lixing/文档/image/选区_238.png)

在辅助索引的叶子节点数据区保存地址？这样是不行的，因为地址会变，主键索引树为了保持平衡，会不停地变动的。

#### 4.关于索引的各种原则

**列的离散性**

count(distinct col):count(col),比值越高离散性越好

- 若列的离散性越好，列的选择性就越好
- 选择性好的列作为索引更合适
- 离散性差的列作为索引反而会适得其反

区分度低的列作为索引，列的唯一性选择太差，性能还不如全表扫描，因为它还要维护二叉树索引

**最左匹配原则：**对索引项中关键字的对比，一定是从左向右依次进行,遇到范围查询就会停止。

联合索引：也匹配最左匹配原则

单列索引：节点中的关键字只有一列

联合索引：节点中的关键字有多列，（name,phone,age）select * from users where name="张三" and phone>12345 and age>20 .范围查询离散度会变小，后面的列就不匹配了，所以这里的联合索引只会用到前两个列

**覆盖索引：**

通过索引项的信息可直接返回所需的查询列，则该索引称之为查询SQL的覆盖索引，也就是说不需要回表，减少一次扫描

![](/home/lixing/文档/image/选区_239.png)

1,3,5用到了覆盖索引，避免使用select *，因为它不会使用到覆盖索引。

全值匹配我最爱，最左前缀要遵守

带头大哥不能死，中间兄弟不能断

索引列上少计算，范围之后会失效

Like百分写最右，覆盖索引不写星

不等空值还有or，索引失效要少用



